Fold: Rotate many fields into one field
=======================================

.. py:currentmodule:: txf

.. py:class:: Fold(pipeline, inputs, outputs, tags=None)

    The ``Fold`` transform folds (unpivots) a set of fields.

    Simple folding consists of rotating multiple input fields into a single output field
    and a field of tags containing the original input field names.

    This can be generalised to multiple output fields where the input fields
    are broken up into equal-sized groups, each of which is mapped to one of the output fields.
    In the latter case, the tags can be supplied by the caller or generated by concatenating the field names.

    .. py:attribute:: pipeline
        :type: Transform

        The input pipeline (required).

    .. py:attribute:: inputs
        :type: tuple(str)

        The list of fields to be folded.
        They will be dropped from the output, so use :py:class:`Copy` to preserve them.

    .. py:attribute:: outputs
        :type: tuple(str)

        The the output fields receiving the tags and the folded fields.
        The first output contains the tags and the remaining fields contain the group values.
        The number of *inputs* must be a multiple of the number of groups.
        They cannot overwrite existing fields, so use :py:class:`Drop` to remove unwanted fields.

    .. py:attribute:: tags
        :type: tuple(str)

        The optional tags for the output. It will be generated if not provided.

Usage
^^^^^

.. code-block:: python

   Fold(p, ('Sales 1992', 'Sales 1993', 'Sales 1994',),
           ('Year', 'Sales',), ('1992', '1993', '1994',))
   Fold(p, ('Sales 1992', 'Sales 1993', 'Sales 1994', 'Profit 1992', 'Profit 1993', 'Profit 1994',),
           ('Year', 'Sales', 'Profit',), ('1992', '1993', '1994',))

Examples
^^^^^^^^

Single Fold
-----------

.. csv-table:: Input
    :header: "Key", "Sales 1992", "Sales 1993", "Sales 1994"
    :align: left

    0, "S-0-1992", "S-0-1993", "S-0-1994"
    1, "S-1-1992", "S-1-1993", "S-1-1994"

.. csv-table:: Output
    :header: "Key", "Year", "Sales"
    :align: left

    0, 1992, "S-0-1992"
    0, 1993, "S-0-1993"
    0, 1994, "S-0-1994"
    1, 1992, "S-1-1992"
    1, 1993, "S-1-1993"
    1, 1994, "S-1-1994"

Multiple Folds
--------------

.. csv-table:: Input
    :header: "Key", "Sales 1992", "Sales 1993", "Sales 1994", "Profit 1992", "Profit 1993", "Profit 1994"
    :align: left
    :widths: 1, 8, 8, 8, 8, 8, 8

    0, "S-0-1992", "S-0-1993", "S-0-1994", "P-0-1992", "P-0-1993", "P-0-1994"
    1, "S-1-1992", "S-1-1993", "S-1-1994", "P-1-1992", "P-1-1993", "P-1-1994"

.. csv-table:: Output
    :header: "Key", "Year", "Sales", "Profit"
    :align: left

    0, 1992, "S-0-1992", "P-0-1992"
    0, 1993, "S-0-1993", "P-0-1993"
    0, 1994, "S-0-1994", "P-0-1994"
    1, 1992, "S-1-1992", "P-1-1992"
    1, 1993, "S-1-1993", "P-1-1993"
    1, 1994, "S-1-1994", "P-1-1994"
